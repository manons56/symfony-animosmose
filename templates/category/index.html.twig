{% extends 'base.html.twig' %}

{% block title %}Catégories produits{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
    <h2>Catégories</h2>
    <h2>Catégories</h2>
    <ul id="menu">
        {% for category in categories %}
            <li>{{ category.name }}
                {% if category.subcategories|length > 0 %}
                    <ul>
                        {% for sub in category.subcategories %}
                            <li data-id="{{ sub.id }}">{{ sub.name }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h2>Produits</h2>
    <div id="products">Cliquez sur une sous-catégorie pour voir les produits.</div>

    <script>
        // Select all submenu items
        const subItems = document.querySelectorAll('#menu li ul li');

        // Get the div where products will be displayed
        const productsDiv = document.getElementById('products');

        // Add click event to each submenu item
        subItems.forEach(sub => {
            sub.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent the click from bubbling up to parent (keeps the menu open)

                // Get the category id from the data-id attribute
                const categoryId = sub.getAttribute('data-id');

                // Fetch products for this category
                fetch(`/category/${categoryId}/products`)
                    .then(response => response.json()) // Convert response to JSON
                    .then(products => {
                        // Transform each product into an HTML block
                        const productHtmlArray = products.map(product => {
                            return `<div class="product">${product.name} - ${product.price}€</div>`;
                        });

                        // Combine all HTML blocks into a single string
                        const productHtml = productHtmlArray.join('');

                        // Display the products or a message if none are available
                        productsDiv.innerHTML = productHtml || 'Aucun produit disponible.';
                    })
                    .catch(err => {
                        // Display error message and log the error
                        productsDiv.innerHTML = 'Erreur lors du chargement des produits.';
                        console.error(err);
                    });
            });
        });

        // Handle simple dropdown menu
        const menuItems = document.querySelectorAll('#menu > li');

        menuItems.forEach(item => {
            const subMenu = item.querySelector('ul');
            if (subMenu) {
                // Toggle submenu visibility on click
                item.addEventListener('click', () => {
                    if (subMenu.style.display === 'block') {
                        subMenu.style.display = 'none'; // Hide submenu if currently visible
                    } else {
                        subMenu.style.display = 'block'; // Show submenu if currently hidden
                    }
                });
            }
        });

    </script>

    <style>
        ul { list-style: none; padding: 0; margin: 0; }
        li { cursor: pointer; padding: 8px 12px; background: #f5f5f5; margin-bottom: 2px; position: relative; }
        li:hover { background: #e0e0e0; }
        li ul { display: none; padding-left: 20px; }
        li ul li { background: #fafafa; margin-bottom: 0; }
        li ul li:hover { background: #f0f0f0; }

        #products { margin-top: 20px; }
        .product { padding: 10px; border: 1px solid #ccc; margin-bottom: 5px; border-radius: 5px; }
    </style>

</div>
{% endblock %}
