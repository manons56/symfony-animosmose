{% extends 'base.html.twig' %}

{% block title %}Hello CategoryController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
    <h2>Catégories</h2>
    <h2>Catégories</h2>
    <ul id="menu">
        {% for category in categories %}
            <li>{{ category.name }}
                {% if category.subcategories|length > 0 %}
                    <ul>
                        {% for sub in category.subcategories %}
                            <li data-id="{{ sub.id }}">{{ sub.name }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <h2>Produits</h2>
    <div id="products">Cliquez sur une sous-catégorie pour voir les produits.</div>

    <script>
        const subItems = document.querySelectorAll('#menu li ul li');
        const productsDiv = document.getElementById('products');

        subItems.forEach(sub => {
            sub.addEventListener('click', (e) => {
                e.stopPropagation(); // empêche le menu parent de se fermer
                const categoryId = sub.getAttribute('data-id');

                fetch(`/category/${categoryId}/products`)
                    .then(response => response.json())
                    .then(products => {
                        productsDiv.innerHTML = products.length
                            ? products.map(p => `<div class="product">${p.name} - ${p.price}€</div>`).join('')
                            : 'Aucun produit disponible.';
                    })
                    .catch(err => {
                        productsDiv.innerHTML = 'Erreur lors du chargement des produits.';
                        console.error(err);
                    });
            });
        });

        // Menu déroulant simple
        const menuItems = document.querySelectorAll('#menu > li');
        menuItems.forEach(item => {
            const subMenu = item.querySelector('ul');
            if(subMenu){
                item.addEventListener('click', () => {
                    subMenu.style.display = subMenu.style.display === 'block' ? 'none' : 'block';
                });
            }
        });
    </script>

    <style>
        ul { list-style: none; padding: 0; margin: 0; }
        li { cursor: pointer; padding: 8px 12px; background: #f5f5f5; margin-bottom: 2px; position: relative; }
        li:hover { background: #e0e0e0; }
        li ul { display: none; padding-left: 20px; }
        li ul li { background: #fafafa; margin-bottom: 0; }
        li ul li:hover { background: #f0f0f0; }

        #products { margin-top: 20px; }
        .product { padding: 10px; border: 1px solid #ccc; margin-bottom: 5px; border-radius: 5px; }
    </style>

</div>
{% endblock %}
