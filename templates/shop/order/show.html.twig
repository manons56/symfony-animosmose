{% extends 'base.html.twig' %}
{% set current_page = 'order' %}

{% block title %}Commande #{{ order.id }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('order') }}
{% endblock %}

{% block body %}
    <a href="{{ path('app_shop_cart') }}">
        <img src="{{ asset('build/images/back_arrow.png') }}" alt="Flèche retour" class="back_arrow">
    </a>


    <h2>Livraison et paiement</h2>
<div class="add-padding">
    <table class="order-table">
        <thead>
        <tr>
            <th>Produit</th>
            <th>Détail</th>
            <th>Quantité</th>
            <th>Prix</th>
            <th>Total</th>
        </tr>
        </thead>
        <tbody>
        {% for article in order.articles %}
            <tr>
                <td>{{ article.variantId.product.name }}</td>
                <td>
                    {% if article.variantId.contenance %}
                        {{ article.variantId.contenance }}
                    {% else %}
                        {% if article.variantId.size %}
                            Taille : {{ article.variantId.size }}
                        {% endif %}
                        {% if article.variantId.color %}
                            <br>Couleur : {{ article.variantId.color }}
                        {% endif %}
                    {% endif %}
                </td>
                <td>{{ article.quantity }}</td>
                <td>{{ article.price }} €</td>
                <td>{{ (article.price * article.quantity)|number_format(2, '.', ' ') }} €</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="order-mobile">
        {% for article in order.articles %}
            <div class="order-item">
                <div class="order-item-header font-weight-bold">
                    {{ article.variantId.product.name }}
                </div>
                <div>
                    {% if article.variantId.contenance %}
                        Contenance : {{ article.variantId.contenance }}
                    {% else %}
                        {% if article.variantId.size %}
                            Taille : {{ article.variantId.size }}
                        {% endif %}
                        {% if article.variantId.color %}
                            <br>Couleur : {{ article.variantId.color }}
                        {% endif %}
                    {% endif %}
                </div>

                <div>Quantité : {{ article.quantity }}</div>
                <div>Prix unitaire : {{ article.price }} €</div>
                <div>Total : {{ (article.price * article.quantity)|number_format(2, '.', ' ') }} €</div>
            </div>
        {% else %}
            <p>Aucun article dans cette commande.</p>
        {% endfor %}
    </div>
    </br>

    {{ form_start(form) }}


    {# Ce bloc sert à afficher la liste de méthodes de livraison sous forme de boutons radio ou de cases à cocher,
     avec des données supplémentaires (prix et description) associées à chaque option. #}
    <div class="delivery-methods">
        {% for child in form.delivery_method %}
            {% set key = child.vars.value %}
            <label>
                {{ form_widget(child, { attr: {'data-price': deliveryOptions[key].price} }) }}
                {{ child.vars.label }}
            </label>
            <small>{{ deliveryOptions[key].description }}</small>
            </br>
        {% endfor %}
    </div>
    <p>Pour les livraisons à domicile ou le retrait sur place, les paiements peuvent s'effectuer par chèque, virement ou espèces.</p>
    <div class="order-totals">
        <p>Total produits : <strong id="base-total">{{ order.total|number_format(2, '.', ' ') }}</strong> €</p>
        <p>Frais de livraison : <strong id="delivery-price">0.00</strong> €</p>
        <p><strong>Total final : <span id="final-total">{{ order.total|number_format(2, '.', ' ') }}</span> €</strong></p>
    </div>
    </br>
    <div class="cgv-container">
        <label>
            <span>
                En cochant, vous acceptez nos
                <a href="{{ path('app_content_cgv') }}" target="_blank">conditions générales de vente</a> et notre <a href="{{ path('app_content_confidentialite') }}"  target="_blank">politique de confidentialité </a>.
            </span>
            {{ form_widget(form.cgv) }}
        </label>
    </div>



    {# Bouton Payline – Mondial Relay seulement #}
    {# Bouton Payline – toujours présent mais masqué par défaut #}
    <a id="payline-button" href="{{ path('checkout_pay', {'orderId': order.id}) }}" class="btn" style="display:none;">
        Payer avec Payline
    </a>

    <button type="submit" class="btn" id="submit-button">Valider ma commande</button>


    {{ form_end(form) }}
</div>
{% endblock %}


